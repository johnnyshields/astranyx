# Canvas HUD Implementation

## Overview

Replaced the WebGL quad-based HUD with a 2D HTML Canvas overlay. This provides cleaner text rendering, easier styling, and better separation between game rendering and UI.

## Architecture

### Dual-Layer Rendering
```
┌─────────────────────────────────────┐
│          Canvas HUD (2D)            │  <- Top layer (HTML canvas)
│  - Text labels                      │
│  - Health bars                      │
│  - Weapon slots                     │
│  - Score/wave info                  │
├─────────────────────────────────────┤
│         WebGL Canvas (3D)           │  <- Bottom layer
│  - Ships, enemies, bullets          │
│  - Meshes, particles, effects       │
│  - Background starfield             │
└─────────────────────────────────────┘
```

### Coordinate System Challenge

The HUD needed to align floating labels over game entities. This required converting between three coordinate spaces:

1. **World Space**: Game simulation coordinates (fixed-point, Y+ up)
2. **HUD Design Space**: Virtual coordinates (-500 to +500, Y+ up)
3. **Canvas Pixel Space**: Actual canvas pixels (Y+ down)

Solution - `worldToCanvas()` method:
```typescript
private worldToCanvas(worldScreenX: number, worldScreenY: number): { x: number; y: number } {
  const scaleX = this.viewportWidth / this.DESIGN_WIDTH
  const scaleY = this.viewportHeight / this.DESIGN_HEIGHT
  return {
    x: this.viewportX + (worldScreenX + this.DESIGN_WIDTH / 2) * scaleX,
    y: this.viewportY + (this.DESIGN_HEIGHT / 2 - worldScreenY) * scaleY,  // Y flip
  }
}
```

## Files Modified

### `src/ui/HUD.ts` (NEW)
Complete 2D canvas HUD system:

**Core Setup**:
- Creates canvas element overlaying WebGL canvas
- Matches viewport sizing with 5:3 aspect ratio letterbox/pillarbox
- Loads Munro pixel font

**Rendering Methods**:
- `renderPlayerHUD()` - Lives, score, multiplier, charge bar
- `renderGameState()` - Wave number, boss health
- `renderWeaponSlots()` - Equipped weapons with ammo bars
- `renderWeaponDropLabels()` - Floating weapon name labels
- `renderEntityHealthBars()` - Enemy/boss health bars above entities

**Styling**:
- White text with black outline (2px stroke)
- Munro pixel font family
- Color-coded ammo types (gold, orange, green, blue)

### `index.html`
Added Munro font declarations:
```css
@font-face {
  font-family: 'Munro';
  src: url('/assets/fonts/munro/munro-regular.woff2') format('woff2'),
       url('/assets/fonts/munro/munro-regular.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: block;
}
```

### `src/game/Game.ts`
- Added HUD import and initialization
- Removed old quad-based methods: `renderHUD`, `renderWeaponDropLabel`, `renderBossHealthBar`, `renderEnemyHealthBar`
- New `renderCanvasHUD()` orchestrates all HUD rendering

## HUD Layout

```
┌─────────────────────────────────────────────────────────────┐
│ WAVE 5                                          SCORE: 12500│
│                                                 x8.0        │
│ [Vulcan ████████] [Jericho ███░░░]             ♥♥♥         │
│      ^active                                                │
│                                                             │
│                    ┌──────────────┐                         │
│                    │ BOSS: ██████ │  <- Boss health bar     │
│                    └──────────────┘                         │
│                                                             │
│              [Enemy health bars float above enemies]        │
│                                                             │
│                     "Hornet"  <- Weapon drop label          │
│                        ◇                                    │
│                                                             │
│    ◄ Player                                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## Bugs Fixed

### Label/Health Bar Misalignment
**Problem**: UI elements appeared at wrong positions relative to game entities.

**Root Cause**: `worldToScreen()` returns HUD design coordinates (-500 to +500), but canvas drawing methods were using them directly as pixel coordinates.

**Fix**: Added `worldToCanvas()` conversion method that:
1. Takes HUD design coordinates from `worldToScreen()`
2. Scales by viewport dimensions
3. Applies viewport offset for letterbox/pillarbox
4. Flips Y axis (canvas Y+ is down, world Y+ is up)

### Health Bars Below Enemies
**Problem**: Health bars appeared below enemies instead of above.

**Root Cause**: Used negative Y offset, but in world space Y+ is up.

**Fix**: Changed offset calculation:
```typescript
// Before (wrong):
const worldY = enemy.y - config.scale * config.depth / 2 - 10

// After (correct):
const worldY = enemy.y + config.scale * config.depth / 2 + 15
```

## Performance Considerations

- Canvas cleared and redrawn each frame
- Text rendering uses `strokeText` + `fillText` for outline effect
- Health bars only rendered for damaged entities
- Weapon labels only rendered for visible drops
